<div class="group-page-container">
    
    <header class="page-header">
        <h1 class="group-title">{{ groupName() }}</h1>
    </header>

    @if (isLoading()) {
        <div class="loading-state">
            <p>Carregando dados do grupo...</p>
            </div>
    } @else if (errorMessage()) {
        <div class="alert error">
            <p>Erro: {{ errorMessage() }}</p>
            <button (click)="loadGroupData(groupId()!)">Tentar Novamente</button>
        </div>
    } @else {
        <nav class="tabs-nav">
            @for (tab of tabs; track tab.key) {
                <button 
                    [class.active]="activeTab() === tab.key" 
                    (click)="setActiveTab(tab.key)">
                    {{ tab.label }}
                    @if (tab.key === 'members' && members().length > 0) {
                        ({{ members().length }})
                    }
                </button>
            }
        </nav>

        <div class="tab-content">
            @if (activeTab() === 'members') {
                <div class="members-list-container">
                    <h2>Membros ({{ members().length }})</h2>
                    
                    @for (member of members(); track member.userId) {
                        <div class="member-item">
                            <img [src]="'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png'" alt="{{ member.name }}" class="member-avatar">
                            <div class="member-info">
                                <span class="member-name">{{ member.name }}</span>
                                <span class="member-role">{{ member.email }}</span>
                            </div>
                            @if (member.role === 'Organizador') {
                                <span class="role-tag">Organizador</span>
                            }
                        </div>
                    } @empty {
                        <p class="empty-state">Este grupo ainda não tem membros.</p>
                    }

                    <div class="action-buttons-footer">
                        <button class="btn btn-primary">Editar Grupo</button>
                        <button class="btn btn-secondary">Sair do Grupo</button>
                    </div>
                </div>
            }

            @if (activeTab() === 'destinations') {
                <div class="section-container">
                    <div class="section-header-with-button">
                        <h2>Destinos Planejados</h2>
                        <button class="btn btn-primary" (click)="openModal('destination')">
                            + Sugerir Destino
                        </button>
                    </div>
                    
                    @for (destination of destinations(); track destination.id) {
                        <div class="item-card destination-card">
                            <h3>{{ destination.name }}</h3>
                            <p class="location">{{ destination.location }}</p>
                            <p class="description">{{ destination.description }}</p>
                        </div> 
                    } @empty {
                        <p class="empty-state">Nenhum destino foi sugerido ainda.</p>
                    }
                </div>
            }
            
            @if (activeTab() === 'votings') {
                <div class="section-container">
                    <div class="section-header-with-button">
                        <h2>Votações Ativas</h2>
                        <button class="btn btn-primary" (click)="openModal('voting')">
                            + Criar Votação
                        </button>
                    </div>

                    @for (voting of votings(); track voting.id) {
                        <div class="item-card voting-card">
                            <h3>{{ voting.question }}</h3>
                            <p>Opções: {{ voting.options.join(', ') }}</p>
                            <p>Votos: {{ voting.totalVotes }}</p>
                            @if (voting.userVote) {
                                <span class="voted-tag">Seu voto: {{ voting.userVote }}</span>
                            } @else {
                                <button class="btn btn-secondary" (click)="openVoteModal(voting)">Votar</button>
                            }
                        </div> 
                    } @empty {
                        <p class="empty-state">Não há votações ativas ou passadas.</p>
                    }
                </div>
            }
            
            @if (activeTab() === 'expenses') {
                <div class="section-container">
                    <div class="section-header-with-button">
                        <h2>Despesas do Grupo</h2>
                        <button class="btn btn-primary" (click)="openModal('expense')">
                            + Registrar Despesa
                        </button>
                    </div>

                    @for (expense of expenses(); track expense.id) {
                        <div class="item-card expense-card">
                            <h3>{{ expense.description }}</h3>
                            <p class="amount">R$ {{ expense.amount | number: '1.2-2' }}</p>
                            <p>Pago por: {{ expense.payerName }}</p>
                            <p>Rateio entre {{ expense.participantsCount }} pessoas</p>
                        </div> 
                    } @empty {
                        <p class="empty-state">Nenhuma despesa foi registrada.</p>
                    }
                </div>
            }
        </div>
    }
</div>

@if (showCreateDestination()) {
    <app-creat-destination-modal
        [groupId]="groupId()!"
        (close)="closeAllModals()"
        (destinationCreated)="handleCreationSuccess()"
    />
}

@if (showCreateVoting()) {
    <app-create-voting-modal
        [groupId]="groupId()!"
        (close)="closeAllModals()"
        (votingCreated)="handleCreationSuccess()"
    />
}

@if (showCreateExpense()) {
    <app-create-expenses-modal
        [groupId]="groupId()!"
        [members]="members()"
        [loggedUserId]="loggedUserId()"
        (close)="closeAllModals()"
        (expenseCreated)="handleCreationSuccess()"
    />
} 

@if (showVoteModal() && selectedVoting()) {
    <app-vote-modal
        [groupId]="groupId()!"
        [voting]="selectedVoting()!"
        (close)="closeAllModals()"
        (voteSubmitted)="handleCreationSuccess()"
    />
}